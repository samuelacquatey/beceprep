<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BECE Past Questions — Select Filters</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">BE</div>
        <div>
          <h1>BECE Prep [Interactive MVP]</h1>
          <p class="lead">Practice by subject or year • Get performance analytics and improvement tips</p>
        </div>
      </div>
      <div style="display: flex; gap: 8px; align-items: center;">
        <button id="dashboardBtn" class="btn ghost">View Analytics</button>
        <button id="logoutBtn" class="btn ghost">Logout</button>
      </div>
    </header>

    <div class="card">
      <div class="section">
        <h3>Filter</h3>
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
          <select id="yearSelect" aria-label="Select year">
            <option value="all">All years</option>
          </select>
          <label style="color:var(--muted);font-size:13px">    </label>
          <select id="modeSelect" aria-label="Mode">
            <option value="practice">Practice Mode</option>
            <option value="exam">Exam Mode</option>
          </select>
        </div>

        <h3>Subjects</h3>
        <div class="subjects" id="subjectsList"></div>
      </div>

      <div class="section">
        <h3>Controls</h3>
        <div class="controls">
          <button id="startBtn" class="btn">Start Quiz</button>
          <label class="switch">
            <input type="checkbox" id="endlessMode">
            <span style="font-size: 13px; color: var(--muted)">Endless Mode</span>
          </label>
        </div>
      </div>
    </div>

    <footer class="small">This is a front-end MVP with dummy questions. Answers are stored in your browser's localStorage.</footer>
  </div>

  <script type="module">
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { app } from "./js/auth.js";

    const auth = getAuth(app);

    /*********************** Enhanced Question Dataset ************************/
    const QUESTIONS = [
      {
        id: 1, year: 2019, subject: 'Mathematics', topic: 'algebraic expressions', 
        subtopic: 'Linear Equations', difficulty: 'medium',
        q: 'Simplify: 3(x+4) - 2x', 
        options: ['x+12', 'x+4', '5x+12', 'x+8'], 
        a: 0
      },
      {
        id: 2, year: 2019, subject: 'English', topic: 'grammar', 
        subtopic: 'Verb Tenses', difficulty: 'easy',
        q: 'Choose the correct sentence', 
        options: ['He dont like it', 'He does not like it', 'He do not like it', 'He not like it'], 
        a: 1
      },
      {
        id: 3, year: 2020, subject: 'Integrated Science', topic: 'plant biology', 
        subtopic: 'Photosynthesis', difficulty: 'medium',
        q: 'Which gas do plants consume?', 
        options: ['Oxygen', 'Nitrogen', 'Carbon dioxide', 'Helium'], 
        a: 2
      },
      {
        id: 4, year: 2020, subject: 'Mathematics', topic: 'sequences', 
        subtopic: 'Geometric Sequences', difficulty: 'medium',
        q: 'What is the next number: 2,4,8,16,...', 
        options: ['20', '24', '32', '34'], 
        a: 2
      },
      {
        id: 5, year: 2021, subject: 'Social Studies', topic: 'civics', 
        subtopic: 'Government Systems', difficulty: 'easy',
        q: 'What is a democracy?', 
        options: ['One-man rule', 'Rule by the people', 'Military rule', 'A type of crop'], 
        a: 1
      },
      {
        id: 6, year: 2021, subject: 'Mathematics', topic: 'algebra', 
        subtopic: 'Linear Equations', difficulty: 'easy',
        q: 'Solve for x: 2x = 10', 
        options: ['4', '5', '10', '8'], 
        a: 1
      },
      {
        id: 7, year: 2022, subject: 'English', topic: 'vocabulary', 
        subtopic: 'Synonyms', difficulty: 'easy',
        q: 'Pick the synonym for "happy"', 
        options: ['Sad', 'Angry', 'Glad', 'Tired'], 
        a: 2
      },
      {
        id: 8, year: 2022, subject: 'Integrated Science', topic: 'measurement', 
        subtopic: 'Scientific Instruments', difficulty: 'easy',
        q: 'Which device measures temperature?', 
        options: ['Barometer', 'Thermometer', 'Ammeter', 'Voltmeter'], 
        a: 1
      },
      {
        id: 9, year: 2023, subject: 'Mathematics', topic: 'geometry', 
        subtopic: 'Area Calculation', difficulty: 'medium',
        q: 'Find area of rectangle with sides 4 and 6', 
        options: ['10', '24', '12', '20'], 
        a: 1
      },
      {
        id: 10, year: 2023, subject: 'Social Studies', topic: 'geography', 
        subtopic: 'African Capitals', difficulty: 'easy',
        q: 'Capital city of Ghana', 
        options: ['Kumasi', 'Accra', 'Tamale', 'Takoradi'], 
        a: 1
      },
      {
        id: 11, year: 2022, subject: 'Mathematics', topic: 'fractions', 
        subtopic: 'Basic Operations', difficulty: 'medium',
        q: 'What is 1/2 + 1/4?', 
        options: ['1/6', '2/6', '3/4', '2/8'], 
        a: 2
      },
      {
        id: 12, year: 2021, subject: 'English', topic: 'comprehension', 
        subtopic: 'Reading Skills', difficulty: 'hard',
        q: 'What is the main idea of a story?', 
        options: ['The first sentence', 'The central message', 'The characters', 'The setting'], 
        a: 1
      }
    ];
    /****************************************************************/

    // DOM refs
    const subjectsList = document.getElementById('subjectsList');
    const yearSelect = document.getElementById('yearSelect');
    const startBtn = document.getElementById('startBtn');
    const modeSelect = document.getElementById('modeSelect');
    const endlessMode = document.getElementById('endlessMode');
    const dashboardBtn = document.getElementById('dashboardBtn');
    const logoutBtn = document.getElementById('logoutBtn');

    // initialize
    function init(){
      populateYears();
      renderSubjects();
      bindEvents();
    }

    function populateYears(){
      const years = Array.from(new Set(QUESTIONS.map(q => q.year))).sort((a, b) => b - a);
      yearSelect.innerHTML = '<option value="all">All years</option>';
      for(const y of years){
        const o = document.createElement('option'); 
        o.value = y; 
        o.textContent = y; 
        yearSelect.appendChild(o);
      }
    }

    function renderSubjects(){
      const subjects = Array.from(new Set(QUESTIONS.map(q => q.subject))).sort();
      subjectsList.innerHTML = '';
      for(const t of subjects){
        const chip = document.createElement('button');
        chip.className = 'chip';
        chip.textContent = t;
        chip.setAttribute('data-subject', t);
        chip.addEventListener('click', () => {
          chip.classList.toggle('active');
        });
        subjectsList.appendChild(chip);
      }
    }

    function bindEvents(){
      startBtn.addEventListener('click', startQuiz);
      dashboardBtn.addEventListener('click', () => {
        window.location.href = 'dashboard.html';
      });
      logoutBtn.addEventListener('click', () => {
        signOut(auth).then(() => {
          window.location.href = 'index.html';
        });
      });
    }

    function startQuiz(){
      const selectedSubjects = Array.from(document.querySelectorAll('.chip.active')).map(c => c.dataset.subject);
      const year = yearSelect.value;
      const mode = modeSelect.value;
      const endless = endlessMode.checked;

      if (selectedSubjects.length === 0) {
        alert('Please select at least one subject');
        return;
      }

      // Store filter settings in localStorage
      const filterSettings = {
        selectedSubjects,
        year,
        mode,
        endless
      };
      
      localStorage.setItem('bece_filter_settings', JSON.stringify(filterSettings));
      
      // Redirect to quiz page
      window.location.href = 'qna.html';
    }

    // Protect route - redirect if not authenticated, otherwise init app
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "index.html";
      } else {
        console.log("Logged in:", user.email);
        init();
      }
    });
  </script>
</body>
</html>